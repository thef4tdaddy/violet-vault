echo "ğŸ” Running ESLint check before push..."
npx eslint . --config configs/linting/eslint.config.js --max-warnings 0 --cache --cache-location .eslintcache

if [ $? -ne 0 ]; then
  echo "âŒ ESLint check failed! Push aborted."
  echo "ğŸ”§ Run: npm run lint:fix to auto-fix some issues"
  exit 1
fi

echo "âœ… ESLint passed!"

echo "ğŸ” Running TypeScript normal mode check before push..."
# Ignore tsc exit code - we only care about error count vs threshold
# Use --no-strict to override tsconfig.json strict mode for normal mode check
TYPECHECK_OUTPUT=$(npx tsc --noEmit --no-strict --allowJs false 2>&1 || true)
ERROR_COUNT=$(echo "$TYPECHECK_OUTPUT" | { grep "error TS" || true; } | wc -l | tr -d ' ')
# Normal mode threshold: Zero tolerance - no normal mode errors allowed
# Status: 0/0/0 achieved (ESLint/TS normal/TS strict)
ERROR_THRESHOLD=0

if [ "$ERROR_COUNT" -gt "$ERROR_THRESHOLD" ]; then
  echo "âŒ TypeScript normal mode errors detected! ($ERROR_COUNT > $ERROR_THRESHOLD)"
  echo "ğŸ“Š Current errors: $ERROR_COUNT"
  echo "ğŸ“ˆ Threshold: $ERROR_THRESHOLD (zero tolerance)"
  echo "ğŸ”§ Run: npm run typecheck to see all errors"
  exit 1
fi

echo "âœ… TypeScript normal mode check passed! ($ERROR_COUNT errors)"

echo "ğŸ” Running TypeScript strict mode check before push..."
# Ignore tsc exit code - we only care about error count vs threshold
# Strict mode is now enabled in tsconfig.json, so --strict is redundant but kept for clarity
TYPECHECK_OUTPUT=$(npx tsc --noEmit --strict --allowJs false 2>&1 || true)
ERROR_COUNT=$(echo "$TYPECHECK_OUTPUT" | { grep "error TS" || true; } | wc -l | tr -d ' ')
# Strict mode threshold: Zero tolerance - no strict mode errors allowed
# Status: 0/0/0 achieved (ESLint/TS normal/TS strict)
ERROR_THRESHOLD=0

if [ "$ERROR_COUNT" -gt "$ERROR_THRESHOLD" ]; then
  echo "âŒ TypeScript strict mode errors detected! ($ERROR_COUNT > $ERROR_THRESHOLD)"
  echo "ğŸ“Š Current errors: $ERROR_COUNT"
  echo "ğŸ“ˆ Threshold: $ERROR_THRESHOLD (zero tolerance)"
  echo "ğŸ”§ Run: npm run typecheck:strict to see all errors"
  exit 1
fi

echo "âœ… TypeScript strict mode check passed! ($ERROR_COUNT errors)"

echo "ğŸ—ï¸ Running production build before push..."
if ! npm run build; then
  echo "âŒ Production build failed! Push aborted."
  exit 1
fi

echo "âœ… Build succeeded!"
echo "âœ… All checks passed! Push proceeding..."
