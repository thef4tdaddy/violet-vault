# Check if this is a docs-only commit to skip linting
ALL_STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
DOCS_ONLY_PATTERNS="^(docs/|README\.md|\.md$|CHANGELOG\.md|LICENSE|\.husky/)"

# Check if all staged files are documentation
DOCS_ONLY=true
for file in $ALL_STAGED_FILES; do
  if ! echo "$file" | grep -qE "$DOCS_ONLY_PATTERNS"; then
    DOCS_ONLY=false
    break
  fi
done

# Skip linting for docs-only commits
if [ "$DOCS_ONLY" = true ] && [ -n "$ALL_STAGED_FILES" ]; then
  echo "üìù Documentation-only commit detected, skipping ESLint"
  echo "üìÑ Files: $(echo $ALL_STAGED_FILES | tr '\n' ' ')"
  exit 0
fi

# Run linting on staged files only for performance
echo "üîç Running ESLint on staged JS/JSX files..."

# Get staged JS/JSX files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|jsx)$')

if [ -n "$STAGED_FILES" ]; then
  echo "Linting staged files: $(echo $STAGED_FILES | tr '\n' ' ')"
  npx eslint $STAGED_FILES --config ./configs/eslint.config.js --max-warnings 50
  
  if [ $? -ne 0 ]; then
    echo "‚ùå ESLint found issues in staged files"
    echo "üí° Run 'npm run lint:fix' to auto-fix issues, then re-stage files"
    exit 1
  fi
  echo "‚úÖ ESLint passed for staged files"
else
  echo "‚úÖ No JS/JSX files staged for commit"
fi

# TODO: Build is freezing during Vite transformation - temporarily disabled
# npm run build
