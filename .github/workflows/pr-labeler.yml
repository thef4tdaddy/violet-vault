name: Label PRs Based on Commit Type

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

permissions:
  pull-requests: write
  contents: read

jobs:
  label-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Label PR
        uses: actions/labeler@v6
        with:
          configuration-path: .github/labeler.yml
        continue-on-error: true

      - name: Check for missing labels
        uses: actions/github-script@v8
        with:
          script: |
            const expectedLabels = ['feature', 'bug', 'chore', 'docs', 'refactor', 'testing', 'typescript', 'performance', 'security'];

            try {
              // Get existing labels in the repository
              const { data: repoLabels } = await github.rest.issues.listLabelsForRepo({
                owner: context.repo.owner,
                repo: context.repo.repo,
                per_page: 100
              });

              const existingLabelNames = repoLabels.map(label => label.name);
              const missingLabels = expectedLabels.filter(label => !existingLabelNames.includes(label));

              if (missingLabels.length > 0) {
                await github.rest.issues.createComment({
                  issue_number: context.issue.number,
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  body: `⚠️ **Missing Repository Labels**\n\nThe labeler tried to apply these labels but they don't exist in the repository:\n\n${missingLabels.map(l => `- \`${l}\``).join('\n')}\n\nPlease create these labels in [repository settings](https://github.com/${context.repo.owner}/${context.repo.repo}/labels) to enable automatic PR labeling.`
                });
              }
            } catch (error) {
              console.log('Label check skipped:', error.message);
            }
