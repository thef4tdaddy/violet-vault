name: Block PRs to main not from develop

on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]

jobs:
  block-unapproved-prs:
    runs-on: ubuntu-latest
    steps:
      - name: Block if PR is not from develop
        run: |
          PR_NUMBER=${{ github.event.pull_request.number }}
          REPO=${{ github.repository }}
          if [[ "${{ github.head_ref }}" != "develop" ]]; then
            echo "🚫 Pull request blocked."
            echo "🔒 Only pull requests from the 'develop' branch are allowed to merge into 'main'."
            echo "📍 This PR is from: '${{ github.head_ref }}'"
            echo ""
            echo "✅ To proceed:"
            echo "1. Rebase or merge your changes onto 'develop'"
            echo "2. Open a new pull request from 'develop' to 'main'"
            exit 1
          else
            echo "✅ PR source is 'develop' — continuing."
          fi
      - name: Comment on PR if blocked
        if: github.head_ref != 'develop'
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr comment "$PR_NUMBER" --repo "$REPO" --body "🚫 This pull request targets \`main\` but does not originate from the \`develop\` branch. Please rebase or merge your changes onto \`develop\`, then open a new PR from \`develop\` to \`main\`."
