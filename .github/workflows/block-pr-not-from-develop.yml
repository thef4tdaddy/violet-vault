name: Block PRs to main not from develop

on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]

# Prevent duplicate runs
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number }}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: write

jobs:
  block-unapproved-prs:
    runs-on: ubuntu-latest
    steps:
      - name: Block if PR is not from develop
        run: |
          PR_NUMBER=${{ github.event.pull_request.number }}
          REPO=${{ github.repository }}
          if [[ "${{ github.head_ref }}" != "develop" ]]; then
            echo "ğŸš« Pull request blocked."
            echo "ğŸ”’ Only pull requests from the 'develop' branch are allowed to merge into 'main'."
            echo "ğŸ“ This PR is from: '${{ github.head_ref }}'"
            echo ""
            echo "âœ… To proceed:"
            echo "1. Rebase or merge your changes onto 'develop'"
            echo "2. Open a new pull request from 'develop' to 'main'"
            exit 1
          else
            echo "âœ… PR source is 'develop' â€” continuing."
          fi
      - name: Comment on PR if blocked
        if: github.head_ref != 'develop'
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr comment "$PR_NUMBER" --repo "$REPO" --body "ğŸš« This pull request targets \`main\` but does not originate from the \`develop\` branch. Please rebase or merge your changes onto \`develop\`, then open a new PR from \`develop\` to \`main\`."
