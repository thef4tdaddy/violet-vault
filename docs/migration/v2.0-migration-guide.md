# v2.0 Migration Guide

**Version**: 2.0.0  
**Release Date**: 2025-11-29  
**Migration Complexity**: Medium  
**Estimated Time**: 15-30 minutes

## Overview

VioletVault v2.0 represents a major milestone with TypeScript conversion, comprehensive Zod schema validation, and data model simplification. This guide will help you migrate from v1.x to v2.0 safely.

## ‚ö†Ô∏è Breaking Changes

### 1. TypeScript Conversion

- **All code is now TypeScript** - JavaScript files have been converted to `.ts`/`.tsx`
- **Stricter type checking** - TypeScript strict mode is enabled
- **Import paths** - All imports must use `@` alias (e.g., `@/utils/foo`), never relative `../`
- **No `any` types** - All types must be properly defined

**Impact**: If you have custom code or extensions, you'll need to update them to TypeScript.

### 2. Data Model Simplification

The data model has been simplified to a two-entity system:

#### Before (v1.x):

- Separate entities: Envelopes, Savings Goals, Supplemental Accounts, Bills, Debts, Transactions
- Complex relationships between entities
- Multiple sources of truth for balances

#### After (v2.0):

- **Envelopes** - All money holders (including savings goals and supplemental accounts)
- **Transactions** - All financial operations
- **Budget Metadata** - High-level balance tracking

**Key Changes**:

- Savings Goals ‚Üí Envelopes with `envelopeType: "savings"`
- Supplemental Accounts ‚Üí Envelopes with `envelopeType: "supplemental"`
- Bills remain as planned transactions (not money holders)
- Debts remain as bills with additional tracking

**Migration**: Your existing data will be automatically migrated. No manual steps required.

### 3. Auth Architecture Changes

- **Auth State**: Now uses React Context instead of Zustand
- **Auth Operations**: TanStack Query mutations/queries
- **Zustand**: Only for UI state (modals, forms, temporary interactions)

**Impact**: If you have custom auth code, update to use `AuthContext` instead of Zustand stores.

### 4. Validation Changes

- **All data validated with Zod schemas** - Stricter validation
- **Runtime type checking** - Invalid data will be rejected
- **Form validation** - All forms use Zod schemas

**Impact**: Invalid data that was previously accepted may now be rejected. Review your data for compliance.

### 5. Import/Export Format Changes

- Export format updated to include all data types
- Import validation is stricter
- Schema validation on import/export

**Impact**: Old export files may need to be re-exported in the new format.

## ‚úÖ New Features

### 1. Comprehensive Type Safety

- Full TypeScript coverage
- Zod schema validation for all data
- Runtime type checking
- Better IDE autocomplete and error detection

### 2. Enhanced Data Validation

- All forms validate with Zod schemas
- Better error messages
- Consistent validation patterns
- Type-safe data operations

### 3. Improved Developer Experience

- Better code organization
- Clearer architecture patterns
- Comprehensive documentation
- Type-safe API calls

### 4. Performance Monitoring

- Sentry integration for error tracking
- Performance monitoring for critical operations
- Release tracking for better debugging

## üìã Migration Steps

### Step 1: Backup Your Data

**Before starting migration, create a backup:**

1. Open VioletVault
2. Go to Settings ‚Üí Export Data
3. Download the export file
4. Store it in a safe location

**This is your rollback point if anything goes wrong.**

### Step 2: Update the Application

1. **If using the web app**: The update will happen automatically
2. **If using a local build**: Pull the latest code and rebuild
3. **If using a deployed version**: Deploy the v2.0 release

### Step 3: Automatic Data Migration

The application will automatically migrate your data:

1. **Savings Goals** ‚Üí Converted to envelopes with `envelopeType: "savings"`
2. **Supplemental Accounts** ‚Üí Converted to envelopes with `envelopeType: "supplemental"`
3. **All relationships** ‚Üí Preserved and updated
4. **Balances** ‚Üí Recalculated and verified

**No manual steps required** - this happens automatically on first load.

### Step 4: Verify Your Data

After migration, verify:

1. **Envelopes**: All your envelopes are present
2. **Savings Goals**: Check that savings goals appear as envelopes
3. **Supplemental Accounts**: Verify supplemental accounts are accessible
4. **Transactions**: All transactions are intact
5. **Bills & Debts**: Verify bills and debts are working correctly
6. **Balances**: Check that all balances are correct

### Step 5: Review and Update Custom Code (If Applicable)

If you have custom code or extensions:

1. **Update to TypeScript**: Convert `.js`/`.jsx` files to `.ts`/`.tsx`
2. **Update imports**: Use `@` alias instead of relative paths
3. **Add types**: Define proper TypeScript types
4. **Update auth code**: Use `AuthContext` instead of Zustand
5. **Test thoroughly**: Ensure everything works with new architecture

## üîÑ Rollback Procedures

If you encounter issues and need to rollback:

### Option 1: Restore from Backup

1. Export your current data (if possible)
2. Restore the v1.x version of the app
3. Import your backup file
4. Verify data integrity

### Option 2: Data Export/Import

1. Export your data from v2.0
2. Restore v1.x
3. Import the data (may require format conversion)

### Option 3: Contact Support

If rollback is not possible or data is corrupted:

1. Contact support with your backup file
2. Provide details about the issue
3. Support will help restore your data

## üêõ Troubleshooting

### Issue: Data Not Migrating

**Symptoms**: Savings goals or supplemental accounts missing after update

**Solution**:

1. Check browser console for errors
2. Verify data export/import completed
3. Clear browser cache and reload
4. Contact support if issue persists

### Issue: Validation Errors

**Symptoms**: Forms rejecting valid data

**Solution**:

1. Check error messages for specific validation failures
2. Review data format requirements
3. Update data to match new validation rules
4. Contact support if validation seems incorrect

### Issue: TypeScript Errors in Custom Code

**Symptoms**: Build errors after update

**Solution**:

1. Update custom code to TypeScript
2. Add proper type definitions
3. Update imports to use `@` alias
4. Review TypeScript error messages

### Issue: Auth Not Working

**Symptoms**: Login issues or auth state problems

**Solution**:

1. Clear browser cache and cookies
2. Log out and log back in
3. Check that you're using `AuthContext` instead of Zustand
4. Review auth architecture documentation

## üìö Additional Resources

- **[Data Model Simplification Guide](../architecture/DATA_MODEL_SIMPLIFICATION.md)** - Detailed explanation of the new data model
- **[TypeScript Patterns Guide](../archive/TypeScript-Patterns-Guide.md)** - TypeScript best practices
- **[Zod Integration Guide](../archive/ZOD-INTEGRATION-GUIDE.md)** - Zod validation patterns
- **[Auth Architecture Documentation](../architecture/)** - New auth architecture details
- **[API Documentation](../api/API-Development-Guide.md)** - API changes and updates

## ‚úÖ Migration Checklist

- [ ] Backup created and stored safely
- [ ] Application updated to v2.0
- [ ] Data migration completed automatically
- [ ] All envelopes verified
- [ ] Savings goals converted and verified
- [ ] Supplemental accounts converted and verified
- [ ] Transactions intact
- [ ] Bills and debts working
- [ ] Balances correct
- [ ] Custom code updated (if applicable)
- [ ] No errors in browser console
- [ ] All features working as expected

## üÜò Need Help?

If you encounter issues during migration:

1. **Check the troubleshooting section** above
2. **Review the documentation** in `/docs/`
3. **Open an issue** on GitHub with:
   - Description of the issue
   - Steps to reproduce
   - Browser/OS information
   - Console errors (if any)
   - Backup file (if data-related)

## üéâ Post-Migration

After successful migration:

1. **Explore new features** - Take advantage of improved type safety
2. **Review documentation** - Check out updated guides
3. **Provide feedback** - Let us know how the migration went
4. **Stay updated** - Watch for future improvements

---

**Last Updated**: 2025-11-29  
**Version**: 2.0.0
