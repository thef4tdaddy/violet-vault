# Codecov Configuration
# Enforces high coverage for new files in feature branches

coverage:
  status:
    # Overall project coverage (lenient)
    project:
      default:
        target: auto
        threshold: 5%

    # NEW CODE coverage (strict)
    patch:
      default:
        target: 90% # New code must be 90% covered
        threshold: 0% # No exceptions
        only_pulls: true # Only enforce on PRs

    # CHANGES coverage (strict for feature branches)
    changes:
      default:
        target: 85% # Changed lines must be 85% covered
        threshold: 0%

# Require coverage on new files
flag_management:
  default_rules:
    carryforward: false

# Fail CI if new files have low coverage
github_checks:
  annotations: true

# PR Comment Configuration
comment:
  layout: "diff, flags, files"
  behavior: default
  require_changes: true
  require_base: false
  require_head: true

  # Show files with low coverage
  after_n_builds: 1

# Ignore patterns (if needed)
ignore:
  - "**/__tests__/**"
  - "**/*.test.ts"
  - "**/*.test.tsx"
  - "**/test_*.py"
  - "**/*.spec.ts"
  - "**/vitest.config.ts"
  - "**/setup.ts"

# Strict mode for feature branches
parsers:
  javascript:
    enable_partials: false
